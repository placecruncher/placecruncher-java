<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog logicalFilePath="db.changelog.xml"
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">


    <changeSet id="20120309_create_member" author="placecruncher">
        <createTable tableName="MEMBER">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="EMAIL" type="VARCHAR(320)"></column>
        </createTable>
        <addAutoIncrement tableName="MEMBER" columnName="ID" columnDataType="bigint" />
    </changeSet>

    <changeSet id="20120309_create_principal" author="placecruncher">
        <createTable tableName="PRINCIPAL">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            
            <column name="MEMBER_ID" type="BIGINT"><constraints nullable="false"/></column>
        </createTable>

        <addAutoIncrement tableName="PRINCIPAL" columnName="ID" columnDataType="bigint" />

        <addForeignKeyConstraint constraintName="FK_PRINCIPAL_MEMBER"
            baseTableName="PRINCIPAL" baseColumnNames="MEMBER_ID"
            referencedTableName="MEMBER" referencedColumnNames="ID" />

    </changeSet>

    <changeSet id="20120311_create_place" author="placecruncher">
        <createTable tableName="PLACE">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="NAME" type="VARCHAR(256)"></column>
            <column name="TITLE" type="VARCHAR(512)"></column>
            <column name="DESCRIPTION" type="VARCHAR(4096)"></column>
            <column name="ADDRESS" type="VARCHAR(256)"></column>
            <column name="CITY" type="VARCHAR(128)"></column>
            <column name="STATE" type="VARCHAR(2)"></column>
            <column name="COUNTRY" type="VARCHAR(2)"></column>
            <column name="PHONE" type="VARCHAR(15)"></column>
            <column name="URL" type="VARCHAR(2000)"></column>
        </createTable>
        <addAutoIncrement tableName="PLACE" columnName="ID" columnDataType="bigint" />
    </changeSet>

    <changeSet id="20120311_create_source" author="placecruncher">
        <createTable tableName="SOURCE">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="NAME" type="VARCHAR(256)"></column>
            <column name="TITLE" type="VARCHAR(512)"></column>
            <column name="DESCRIPTION" type="VARCHAR(4096)"></column>
            <column name="URL" type="VARCHAR(2000)"></column>
            <column name="STATUS" type="VARCHAR(64)"><constraints nullable="false"/></column>
        </createTable>
        <addAutoIncrement tableName="SOURCE" columnName="ID" columnDataType="bigint" />
    </changeSet>

    <changeSet id="20120311_create_place_source" author="placecruncher">
        <createTable tableName="PLACE_SOURCE">
            <column name="PLACE_ID" type="BIGINT"><constraints nullable="false" /></column>
            <column name="SOURCE_ID" type="BIGINT"><constraints nullable="false"/></column>
        </createTable>

        <addPrimaryKey tableName="PLACE_SOURCE"
            columnNames="PLACE_ID, SOURCE_ID"
            constraintName="PK_PLACE_SOURCE"/>

        <addForeignKeyConstraint constraintName="FK_PLACE_SOURCE_PLACE"
            baseTableName="PLACE_SOURCE" baseColumnNames="PLACE_ID"
            referencedTableName="PLACE" referencedColumnNames="ID" />

        <addForeignKeyConstraint constraintName="FK_PLACE_SOURCE_SOURCE"
            baseTableName="PLACE_SOURCE" baseColumnNames="SOURCE_ID"
            referencedTableName="SOURCE" referencedColumnNames="ID" />
    </changeSet>

    <changeSet id="20120315_create_place_ref" author="placecruncher">
        <createTable tableName="PLACE_REF">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="PLACE_ID" type="BIGINT"><constraints nullable="false" /></column>
            <column name="MEMBER_ID" type="BIGINT"><constraints nullable="false"/></column>
            <column name="RATING" type="BIGINT" defaultValueNumeric="0"><constraints nullable="false"/></column>
            <column name="PRIVACY" type="VARCHAR(64)"></column>
        </createTable>
        <addAutoIncrement tableName="PLACE_REF" columnName="ID" columnDataType="bigint" />

        <addForeignKeyConstraint constraintName="FK_PLACE_REF_PLACE"
            baseTableName="PLACE_REF" baseColumnNames="PLACE_ID"
            referencedTableName="PLACE" referencedColumnNames="ID" />

        <addForeignKeyConstraint constraintName="FK_PLACE_REF_MEMBER"
            baseTableName="PLACE_REF" baseColumnNames="MEMBER_ID"
            referencedTableName="MEMBER" referencedColumnNames="ID" />
    </changeSet>

    <changeSet id="20120315_create_friend_ref" author="placecruncher">
        <createTable tableName="FRIEND_REF">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="FRIEND_ID" type="BIGINT"><constraints nullable="false" /></column>
            <column name="MEMBER_ID" type="BIGINT"><constraints nullable="false"/></column>
        </createTable>
        <addAutoIncrement tableName="FRIEND_REF" columnName="ID" columnDataType="bigint" />

        <addForeignKeyConstraint constraintName="FK_FRIEND_REF_MEMBER"
            baseTableName="FRIEND_REF" baseColumnNames="MEMBER_ID"
            referencedTableName="MEMBER" referencedColumnNames="ID" />

        <addForeignKeyConstraint constraintName="FK_FRIEND_REF_FRIEND"
            baseTableName="FRIEND_REF" baseColumnNames="FRIEND_ID"
            referencedTableName="MEMBER" referencedColumnNames="ID" />
    </changeSet>

    <changeSet id="20120315_create_tag" author="placecruncher">
        <createTable tableName="TAG">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="NAME" type="VARCHAR(256)"></column>
            <column name="MEMBER_ID" type="BIGINT"><constraints nullable="true"/></column>
        </createTable>
        <addAutoIncrement tableName="TAG" columnName="ID" columnDataType="bigint" />

        <addForeignKeyConstraint constraintName="FK_TAG_MEMBER"
            baseTableName="TAG" baseColumnNames="MEMBER_ID"
            referencedTableName="MEMBER" referencedColumnNames="ID" />

    </changeSet>

    <changeSet id="20120315_create_tag_ref" author="placecruncher">
        <createTable tableName="TAG_REF">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="TAG_ID" type="BIGINT"><constraints nullable="false"/></column>
            <column name="MEMBER_ID" type="BIGINT"><constraints nullable="false"/></column>
            <column name="PLACE_ID" type="BIGINT"><constraints nullable="false"/></column>
        </createTable>
        <addAutoIncrement tableName="TAG_REF" columnName="ID" columnDataType="bigint" />

        <addForeignKeyConstraint constraintName="FK_TAG_REF_MEMBER"
            baseTableName="TAG_REF" baseColumnNames="MEMBER_ID"
            referencedTableName="MEMBER" referencedColumnNames="ID" />

        <addForeignKeyConstraint constraintName="FK_TAG_REF_TAG"
            baseTableName="TAG_REF" baseColumnNames="TAG_ID"
            referencedTableName="TAG" referencedColumnNames="ID" />

        <addForeignKeyConstraint constraintName="FK_TAG_REF_PLACE"
            baseTableName="TAG_REF" baseColumnNames="PLACE_ID"
            referencedTableName="PLACE" referencedColumnNames="ID" />

    </changeSet>

    <changeSet id="20120317_seed_data_log" author="placecruncher">
        <createTable tableName="SEED_DATA_LOG">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="NAME" type="VARCHAR(256)"><constraints unique="true" nullable="false" /></column>
        </createTable>
        <addAutoIncrement tableName="SEED_DATA_LOG" columnName="ID" columnDataType="bigint" />

    </changeSet>

    <changeSet id="20120326_email" author="davidjones">
        <createTable tableName="EMAIL">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="SENDER" type="VARCHAR(256)"><constraints unique="false" nullable="false" /></column>
        </createTable>
        <addAutoIncrement tableName="EMAIL" columnName="ID" columnDataType="bigint" />

    </changeSet>

    <changeSet id="20120328_seed_data_log" author="davidjones">
        <createTable tableName="API_KEY">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="KEY" type="VARCHAR(256)"><constraints unique="true" nullable="false" /></column>
            <column name="SECRET" type="VARCHAR(256)"><constraints unique="false" nullable="false" /></column>
        </createTable>
        <addAutoIncrement tableName="API_KEY" columnName="ID" columnDataType="bigint" />
    </changeSet>

    <changeSet id="20120401_seed_data_log" author="davidjones">
        <addColumn tableName="PRINCIPAL">
             <column name="TOKEN" type="varchar(255)"/>
        </addColumn>
    </changeSet>
    
    <changeSet id="20120518_api_key" author="davidjones">
    	<insert tableName="API_KEY">
      	  <column name="KEY" value="cloud_key"/>
       	  <column name="SECRET" value="cloud_secret"/>
       	  <column name="VERSION" valueNumeric="0"/>
       	  <column name="CREATED" valueDate="2012-05-18T12:00:00"/>
       	  <column name="UPDATED" valueDate="2012-05-18T12:00:00"/>
       	</insert>  
    </changeSet>
    
   <changeSet id="20120518_approved_email" author="davidjones">
        <createTable tableName="APPROVED_EMAIL">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="EMAIL" type="VARCHAR(256)"><constraints unique="true" nullable="false" /></column>
            <column name="PRINCIPAL_ID" type="BIGINT"><constraints unique="false" nullable="false" /></column>
        </createTable>
        <addAutoIncrement tableName="APPROVED_EMAIL" columnName="ID" columnDataType="bigint" />
    </changeSet>

 
   <changeSet id="20120521_drop_tables" author="davidjones">
        <dropTable tableName="PRINCIPAL"/>
        <dropTable tableName="APPROVED_EMAIL"/>
    </changeSet>

	<changeSet id="20120521_change_member" author="davidjones">
		<addColumn tableName="MEMBER">
			<column name="TOKEN" type="varchar(255)" />
			<column name="USERNAME" type="VARCHAR(64)">
				<constraints nullable="false" unique="true" />
			</column>
			<column name="PASSWORD" type="VARCHAR(32)"></column>
			<column name="ENABLED" type="BOOLEAN" defaultValueBoolean="true">
				<constraints nullable="false" />
			</column>
			<column name="LOCKED" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>

	   <changeSet id="20120522_approved_email" author="davidjones">
        <createTable tableName="APPROVED_EMAIL">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="EMAIL" type="VARCHAR(256)"><constraints unique="true" nullable="false" /></column>
            <column name="MEMBER_ID" type="BIGINT"><constraints unique="false" nullable="false" /></column>
        </createTable>
        <addAutoIncrement tableName="APPROVED_EMAIL" columnName="ID" columnDataType="bigint" />
    </changeSet>

</databaseChangeLog>

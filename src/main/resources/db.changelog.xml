<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog logicalFilePath="db.changelog.xml"
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">


    <changeSet id="20120309_create_member" author="placecruncher">
        <createTable tableName="MEMBER">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="EMAIL" type="VARCHAR(320)"></column>
        </createTable>
        <addAutoIncrement tableName="MEMBER" columnName="ID" columnDataType="bigint" />
    </changeSet>

    <changeSet id="20120309_create_principal" author="placecruncher">
        <createTable tableName="PRINCIPAL">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            
            <column name="MEMBER_ID" type="BIGINT"><constraints nullable="false"/></column>
        </createTable>

        <addAutoIncrement tableName="PRINCIPAL" columnName="ID" columnDataType="bigint" />

        <addForeignKeyConstraint constraintName="FK_PRINCIPAL_MEMBER"
            baseTableName="PRINCIPAL" baseColumnNames="MEMBER_ID"
            referencedTableName="MEMBER" referencedColumnNames="ID" />

    </changeSet>

    <changeSet id="20120311_create_place" author="placecruncher">
        <createTable tableName="PLACE">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="NAME" type="VARCHAR(256)"></column>
            <column name="TITLE" type="VARCHAR(512)"></column>
            <column name="DESCRIPTION" type="VARCHAR(4096)"></column>
            <column name="ADDRESS" type="VARCHAR(256)"></column>
            <column name="CITY" type="VARCHAR(128)"></column>
            <column name="STATE" type="VARCHAR(2)"></column>
            <column name="COUNTRY" type="VARCHAR(2)"></column>
            <column name="PHONE" type="VARCHAR(15)"></column>
            <column name="URL" type="VARCHAR(2000)"></column>
        </createTable>
        <addAutoIncrement tableName="PLACE" columnName="ID" columnDataType="bigint" />
    </changeSet>

    <changeSet id="20120311_create_source" author="placecruncher">
        <createTable tableName="SOURCE">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="NAME" type="VARCHAR(256)"></column>
            <column name="TITLE" type="VARCHAR(512)"></column>
            <column name="DESCRIPTION" type="VARCHAR(4096)"></column>
            <column name="URL" type="VARCHAR(2000)"></column>
            <column name="STATUS" type="VARCHAR(64)"><constraints nullable="false"/></column>
        </createTable>
        <addAutoIncrement tableName="SOURCE" columnName="ID" columnDataType="bigint" />
    </changeSet>

    <changeSet id="20120311_create_place_source" author="placecruncher">
        <createTable tableName="PLACE_SOURCE">
            <column name="PLACE_ID" type="BIGINT"><constraints nullable="false" /></column>
            <column name="SOURCE_ID" type="BIGINT"><constraints nullable="false"/></column>
        </createTable>

        <addPrimaryKey tableName="PLACE_SOURCE"
            columnNames="PLACE_ID, SOURCE_ID"
            constraintName="PK_PLACE_SOURCE"/>

        <addForeignKeyConstraint constraintName="FK_PLACE_SOURCE_PLACE"
            baseTableName="PLACE_SOURCE" baseColumnNames="PLACE_ID"
            referencedTableName="PLACE" referencedColumnNames="ID" />

        <addForeignKeyConstraint constraintName="FK_PLACE_SOURCE_SOURCE"
            baseTableName="PLACE_SOURCE" baseColumnNames="SOURCE_ID"
            referencedTableName="SOURCE" referencedColumnNames="ID" />
    </changeSet>

    <changeSet id="20120315_create_place_ref" author="placecruncher">
        <createTable tableName="PLACE_REF">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="PLACE_ID" type="BIGINT"><constraints nullable="false" /></column>
            <column name="MEMBER_ID" type="BIGINT"><constraints nullable="false"/></column>
            <column name="RATING" type="BIGINT" defaultValueNumeric="0"><constraints nullable="false"/></column>
            <column name="PRIVACY" type="VARCHAR(64)"></column>
        </createTable>
        <addAutoIncrement tableName="PLACE_REF" columnName="ID" columnDataType="bigint" />

        <addForeignKeyConstraint constraintName="FK_PLACE_REF_PLACE"
            baseTableName="PLACE_REF" baseColumnNames="PLACE_ID"
            referencedTableName="PLACE" referencedColumnNames="ID" />

        <addForeignKeyConstraint constraintName="FK_PLACE_REF_MEMBER"
            baseTableName="PLACE_REF" baseColumnNames="MEMBER_ID"
            referencedTableName="MEMBER" referencedColumnNames="ID" />
    </changeSet>

    <changeSet id="20120315_create_friend_ref" author="placecruncher">
        <createTable tableName="FRIEND_REF">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="FRIEND_ID" type="BIGINT"><constraints nullable="false" /></column>
            <column name="MEMBER_ID" type="BIGINT"><constraints nullable="false"/></column>
        </createTable>
        <addAutoIncrement tableName="FRIEND_REF" columnName="ID" columnDataType="bigint" />

        <addForeignKeyConstraint constraintName="FK_FRIEND_REF_MEMBER"
            baseTableName="FRIEND_REF" baseColumnNames="MEMBER_ID"
            referencedTableName="MEMBER" referencedColumnNames="ID" />

        <addForeignKeyConstraint constraintName="FK_FRIEND_REF_FRIEND"
            baseTableName="FRIEND_REF" baseColumnNames="FRIEND_ID"
            referencedTableName="MEMBER" referencedColumnNames="ID" />
    </changeSet>

    <changeSet id="20120315_create_tag" author="placecruncher">
        <createTable tableName="TAG">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="NAME" type="VARCHAR(256)"></column>
            <column name="MEMBER_ID" type="BIGINT"><constraints nullable="true"/></column>
        </createTable>
        <addAutoIncrement tableName="TAG" columnName="ID" columnDataType="bigint" />

        <addForeignKeyConstraint constraintName="FK_TAG_MEMBER"
            baseTableName="TAG" baseColumnNames="MEMBER_ID"
            referencedTableName="MEMBER" referencedColumnNames="ID" />

    </changeSet>

    <changeSet id="20120315_create_tag_ref" author="placecruncher">
        <createTable tableName="TAG_REF">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="TAG_ID" type="BIGINT"><constraints nullable="false"/></column>
            <column name="MEMBER_ID" type="BIGINT"><constraints nullable="false"/></column>
            <column name="PLACE_ID" type="BIGINT"><constraints nullable="false"/></column>
        </createTable>
        <addAutoIncrement tableName="TAG_REF" columnName="ID" columnDataType="bigint" />

        <addForeignKeyConstraint constraintName="FK_TAG_REF_MEMBER"
            baseTableName="TAG_REF" baseColumnNames="MEMBER_ID"
            referencedTableName="MEMBER" referencedColumnNames="ID" />

        <addForeignKeyConstraint constraintName="FK_TAG_REF_TAG"
            baseTableName="TAG_REF" baseColumnNames="TAG_ID"
            referencedTableName="TAG" referencedColumnNames="ID" />

        <addForeignKeyConstraint constraintName="FK_TAG_REF_PLACE"
            baseTableName="TAG_REF" baseColumnNames="PLACE_ID"
            referencedTableName="PLACE" referencedColumnNames="ID" />

    </changeSet>

    <changeSet id="20120317_seed_data_log" author="placecruncher">
        <createTable tableName="SEED_DATA_LOG">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="NAME" type="VARCHAR(256)"><constraints unique="true" nullable="false" /></column>
        </createTable>
        <addAutoIncrement tableName="SEED_DATA_LOG" columnName="ID" columnDataType="bigint" />

    </changeSet>

    <changeSet id="20120326_email" author="davidjones">
        <createTable tableName="EMAIL">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="SENDER" type="VARCHAR(256)"><constraints unique="false" nullable="false" /></column>
        </createTable>
        <addAutoIncrement tableName="EMAIL" columnName="ID" columnDataType="bigint" />

    </changeSet>

    <changeSet id="20120328_seed_data_log" author="davidjones">
        <createTable tableName="API_KEY">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="KEY" type="VARCHAR(256)"><constraints unique="true" nullable="false" /></column>
            <column name="SECRET" type="VARCHAR(256)"><constraints unique="false" nullable="false" /></column>
        </createTable>
        <addAutoIncrement tableName="API_KEY" columnName="ID" columnDataType="bigint" />
    </changeSet>

    <changeSet id="20120401_seed_data_log" author="davidjones">
        <addColumn tableName="PRINCIPAL">
             <column name="TOKEN" type="varchar(255)"/>
        </addColumn>
    </changeSet>
    
    <changeSet id="20120518_api_key" author="davidjones">
    	<insert tableName="API_KEY">
      	  <column name="KEY" value="cloud_key"/>
       	  <column name="SECRET" value="cloud_secret"/>
       	  <column name="VERSION" valueNumeric="0"/>
       	  <column name="CREATED" valueDate="2012-05-18T12:00:00"/>
       	  <column name="UPDATED" valueDate="2012-05-18T12:00:00"/>
       	</insert>  
    </changeSet>
    
   <changeSet id="20120518_approved_email" author="davidjones">
        <createTable tableName="APPROVED_EMAIL">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="EMAIL" type="VARCHAR(256)"><constraints unique="true" nullable="false" /></column>
            <column name="PRINCIPAL_ID" type="BIGINT"><constraints unique="false" nullable="false" /></column>
        </createTable>
        <addAutoIncrement tableName="APPROVED_EMAIL" columnName="ID" columnDataType="bigint" />
    </changeSet>

 
   <changeSet id="20120521_drop_tables" author="davidjones">
        <dropTable tableName="PRINCIPAL"/>
        <dropTable tableName="APPROVED_EMAIL"/>
    </changeSet>

	<changeSet id="20120521_change_member" author="davidjones">
		<addColumn tableName="MEMBER">
			<column name="TOKEN" type="varchar(255)" />
			<column name="USERNAME" type="VARCHAR(64)">
				<constraints nullable="false" unique="true" />
			</column>
			<column name="PASSWORD" type="VARCHAR(32)"></column>
			<column name="ENABLED" type="BOOLEAN" defaultValueBoolean="true">
				<constraints nullable="false" />
			</column>
			<column name="LOCKED" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>

	<changeSet id="20120522_approved_email" author="davidjones">
        <createTable tableName="APPROVED_EMAIL">
            <column name="ID" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="CREATED" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="UPDATED" type="TIMESTAMP"></column>
            <column name="VERSION" type="BIGINT"></column>
            <column name="EMAIL" type="VARCHAR(256)"><constraints unique="true" nullable="false" /></column>
            <column name="MEMBER_ID" type="BIGINT"><constraints unique="false" nullable="false" /></column>
        </createTable>
        <addAutoIncrement tableName="APPROVED_EMAIL" columnName="ID" columnDataType="bigint" />
    </changeSet>
    
    <changeSet id="20120523_drop_api_key" author="davidjones">
        <dropTable tableName="API_KEY"/>
    </changeSet>
    
    <changeSet id="20120523_ApiKey" author="davidjones">
        <createTable tableName="ApiKey">
            <column name="id" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="created" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="updated" type="TIMESTAMP"></column>
            <column name="version" type="BIGINT"></column>
            <column name="key" type="VARCHAR(256)"><constraints unique="true" nullable="false" /></column>
            <column name="secret" type="VARCHAR(256)"><constraints unique="false" nullable="false" /></column>
        </createTable>
        <addAutoIncrement tableName="ApiKey" columnName="id" columnDataType="bigint" />
    </changeSet>
    
     <changeSet id="20120523_insert_ApiKey" author="davidjones">
    	<insert tableName="ApiKey">
      	  <column name="key" value="cloud_key"/>
       	  <column name="secret" value="cloud_secret"/>
       	  <column name="version" valueNumeric="0"/>
       	  <column name="created" valueDate="2012-05-18T12:00:00"/>
       	  <column name="updated" valueDate="2012-05-18T12:00:00"/>
       	</insert>  
    </changeSet>
    
    <changeSet id="20120523_drop_email" author="davidjones">
        <dropTable tableName="EMAIL"/>
    </changeSet>
    
    <changeSet id="20120523_email" author="davidjones">
        <createTable tableName="Email">
            <column name="id" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="created" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="updated" type="TIMESTAMP"></column>
            <column name="version" type="BIGINT"></column>
            <column name="sender" type="VARCHAR(256)"><constraints unique="false" nullable="false" /></column>
        </createTable>
        <addAutoIncrement tableName="email" columnName="id" columnDataType="bigint" />

    </changeSet>
    
    <changeSet id="20120526_delete_tables" author="davidjones">
        <delete tableName="APPROVED_EMAIL"/>
        <delete tableName="FRIEND_REF"/>
        <delete tableName="PLACE_REF"/>
        <delete tableName="PLACE_SOURCE"/>
        <delete tableName="TAG_REF"/>
        <delete tableName="TAG"/>
        <delete tableName="SOURCE"/>
        <delete tableName="PLACE"/>
        <delete tableName="SEED_DATA_LOG"/>
        <delete tableName="MEMBER"/>
        <delete tableName="ApiKey"/>
        <delete tableName="email"/>
    </changeSet>
    
    <changeSet id="20120526_drop_tables" author="davidjones">
        <dropTable tableName="APPROVED_EMAIL"/>
        <dropTable tableName="FRIEND_REF"/>
        <dropTable tableName="PLACE_REF"/>
        <dropTable tableName="TAG_REF"/>
        <dropTable tableName="PLACE_SOURCE"/>
        <dropTable tableName="TAG"/>
        <dropTable tableName="SOURCE"/>
        <dropTable tableName="PLACE"/>
        <dropTable tableName="SEED_DATA_LOG"/>
        <dropTable tableName="MEMBER"/>
        <dropTable tableName="ApiKey"/>
        <dropTable tableName="email"/>
    </changeSet>
    
    <changeSet id="20120526_create_member" author="davidjones">
        <createTable tableName="MEMBER">
            <column name="id" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="created" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="updated" type="TIMESTAMP"></column>
            <column name="version" type="BIGINT"></column>
            <column name="email" type="VARCHAR(320)"></column>
            <column name="token" type="varchar(255)" />
			<column name="username" type="VARCHAR(64)">
				<constraints nullable="false" unique="true" />
			</column>
			<column name="password" type="VARCHAR(32)"></column>
			<column name="enabled" type="BOOLEAN" defaultValueBoolean="true">
				<constraints nullable="false" />
			</column>
			<column name="locked" type="BOOLEAN" defaultValueBoolean="false">
				<constraints nullable="false" />
			</column>
        </createTable>
        <addAutoIncrement tableName="MEMBER" columnName="id" columnDataType="bigint" />
    </changeSet>
    
    <changeSet id="20120526_create_place" author="placecruncher">
        <createTable tableName="PLACE">
            <column name="id" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="created" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="updated" type="TIMESTAMP"></column>
            <column name="version" type="BIGINT"></column>
            <column name="name" type="VARCHAR(256)"></column>
            <column name="title" type="VARCHAR(512)"></column>
            <column name="description" type="VARCHAR(4096)"></column>
            <column name="address" type="VARCHAR(256)"></column>
            <column name="city" type="VARCHAR(128)"></column>
            <column name="state" type="VARCHAR(2)"></column>
            <column name="country" type="VARCHAR(2)"></column>
            <column name="phone" type="VARCHAR(15)"></column>
            <column name="url" type="VARCHAR(2000)"></column>
        </createTable>
        <addAutoIncrement tableName="PLACE" columnName="id" columnDataType="bigint" />
    </changeSet>
    
    <changeSet id="20120526_create_source" author="davidjones">
        <createTable tableName="SOURCE">
            <column name="id" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="created" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="updated" type="TIMESTAMP"></column>
            <column name="version" type="BIGINT"></column>
            <column name="name" type="VARCHAR(256)"></column>
            <column name="title" type="VARCHAR(512)"></column>
            <column name="description" type="VARCHAR(4096)"></column>
            <column name="url" type="VARCHAR(2000)"></column>
            <column name="status" type="VARCHAR(64)"><constraints nullable="false"/></column>
        </createTable>
        <addAutoIncrement tableName="SOURCE" columnName="id" columnDataType="bigint" />
    </changeSet>
    
    
    <changeSet id="20120526_create_place_source" author="placecruncher">
        <createTable tableName="PLACE_SOURCE">
            <column name="placeId" type="BIGINT"><constraints nullable="false" /></column>
            <column name="sourceId" type="BIGINT"><constraints nullable="false"/></column>
        </createTable>

        <addPrimaryKey tableName="PLACE_SOURCE"
            columnNames="placeId, sourceId"
            constraintName="PKPlaceSource"/>

        <addForeignKeyConstraint constraintName="FKPlaceSourcePlace"
            baseTableName="PLACE_SOURCE" baseColumnNames="placeId"
            referencedTableName="PLACE" referencedColumnNames="id" />

        <addForeignKeyConstraint constraintName="FKPlaceSourceSource"
            baseTableName="PLACE_SOURCE" baseColumnNames="sourceId"
            referencedTableName="SOURCE" referencedColumnNames="id" />
    </changeSet>
    
    <changeSet id="20120526_create_place_ref" author="placecruncher">
        <createTable tableName="PLACE_REF">
            <column name="id" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="created" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="updated" type="TIMESTAMP"></column>
            <column name="version" type="BIGINT"></column>
            <column name="placeId" type="BIGINT"><constraints nullable="false" /></column>
            <column name="memberId" type="BIGINT"><constraints nullable="false"/></column>
            <column name="rating" type="BIGINT" defaultValueNumeric="0"><constraints nullable="false"/></column>
            <column name="privacy" type="VARCHAR(64)"></column>
        </createTable>
        <addAutoIncrement tableName="PLACE_REF" columnName="id" columnDataType="bigint" />

        <addForeignKeyConstraint constraintName="FkPlaceRefPlace"
            baseTableName="PLACE_REF" baseColumnNames="placeId"
            referencedTableName="PLACE" referencedColumnNames="id" />

        <addForeignKeyConstraint constraintName="FKPlaceRefMember"
            baseTableName="PLACE_REF" baseColumnNames="memberId"
            referencedTableName="MEMBER" referencedColumnNames="id" />
    </changeSet>
    
    <changeSet id="20120526_create_friend_ref" author="placecruncher">
        <createTable tableName="FRIEND_REF">
            <column name="id" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="created" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="updated" type="TIMESTAMP"></column>
            <column name="version" type="BIGINT"></column>
            <column name="friendId" type="BIGINT"><constraints nullable="false" /></column>
            <column name="memberId" type="BIGINT"><constraints nullable="false"/></column>
        </createTable>
        <addAutoIncrement tableName="FRIEND_REF" columnName="id" columnDataType="bigint" />

        <addForeignKeyConstraint constraintName="FKFriendRefMember"
            baseTableName="FRIEND_REF" baseColumnNames="memberId"
            referencedTableName="MEMBER" referencedColumnNames="id" />

        <addForeignKeyConstraint constraintName="FKFriendRefFriend"
            baseTableName="FRIEND_REF" baseColumnNames="friendId"
            referencedTableName="MEMBER" referencedColumnNames="id" />
    </changeSet>
    
    <changeSet id="201205126_create_tag" author="placecruncher">
        <createTable tableName="TAG">
            <column name="id" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="created" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="updated" type="TIMESTAMP"></column>
            <column name="version" type="BIGINT"></column>
            <column name="name" type="VARCHAR(256)"></column>
            <column name="memberId" type="BIGINT"><constraints nullable="true"/></column>
        </createTable>
        <addAutoIncrement tableName="TAG" columnName="id" columnDataType="bigint" />

        <addForeignKeyConstraint constraintName="FKTagMember"
            baseTableName="TAG" baseColumnNames="memberId"
            referencedTableName="MEMBER" referencedColumnNames="id" />
    </changeSet>
    
        <changeSet id="20120526_create_tag_ref" author="placecruncher">
        <createTable tableName="TAG_REF">
            <column name="id" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="created" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="updated" type="TIMESTAMP"></column>
            <column name="version" type="BIGINT"></column>
            <column name="tagId" type="BIGINT"><constraints nullable="false"/></column>
            <column name="memberId" type="BIGINT"><constraints nullable="false"/></column>
            <column name="placeId" type="BIGINT"><constraints nullable="false"/></column>
        </createTable>
        <addAutoIncrement tableName="TAG_REF" columnName="id" columnDataType="bigint" />

        <addForeignKeyConstraint constraintName="FKTagRefMember"
            baseTableName="TAG_REF" baseColumnNames="memberId"
            referencedTableName="MEMBER" referencedColumnNames="id" />

        <addForeignKeyConstraint constraintName="FKTagRefTag"
            baseTableName="TAG_REF" baseColumnNames="tagId"
            referencedTableName="TAG" referencedColumnNames="id" />

        <addForeignKeyConstraint constraintName="FKTagRefPlace"
            baseTableName="TAG_REF" baseColumnNames="placeId"
            referencedTableName="PLACE" referencedColumnNames="id" />

    </changeSet>
    
    <changeSet id="20120526_seed_data_log" author="placecruncher">
        <createTable tableName="SEED_DATA_LOG">
            <column name="id" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="created" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="updated" type="TIMESTAMP"></column>
            <column name="version" type="BIGINT"></column>
            <column name="name" type="VARCHAR(256)"><constraints unique="true" nullable="false" /></column>
        </createTable>
        <addAutoIncrement tableName="SEED_DATA_LOG" columnName="id" columnDataType="bigint" />
    </changeSet>
    
    <changeSet id="20120528_approvedEmail" author="davidjones">
        <createTable tableName="APPROVED_EMAIL">
            <column name="id" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="created" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="updated" type="TIMESTAMP"></column>
            <column name="version" type="BIGINT"></column>
            <column name="email" type="VARCHAR(256)"><constraints unique="true" nullable="false" /></column>
            <column name="memberId" type="BIGINT"><constraints unique="false" nullable="false" /></column>
        </createTable>
        <addAutoIncrement tableName="APPROVED_EMAIL" columnName="id" columnDataType="bigint" />
    </changeSet>
    
    <changeSet id="20120528_API_KEY" author="davidjones">
        <createTable tableName="API_KEY">
            <column name="id" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="created" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="updated" type="TIMESTAMP"></column>
            <column name="version" type="BIGINT"></column>
            <column name="key" type="VARCHAR(256)"><constraints unique="true" nullable="false" /></column>
            <column name="secret" type="VARCHAR(256)"><constraints unique="false" nullable="false" /></column>
        </createTable>
        <addAutoIncrement tableName="API_KEY" columnName="id" columnDataType="bigint" />
    </changeSet>
    
    <changeSet id="20120528_INSERT_API_KEY" author="davidjones">
    	<insert tableName="API_KEY">
      	  <column name="key" value="cloud_key"/>
       	  <column name="secret" value="cloud_secret"/>
       	  <column name="version" valueNumeric="0"/>
       	  <column name="created" valueDate="2012-05-18T12:00:00"/>
       	  <column name="updated" valueDate="2012-05-18T12:00:00"/>
       	</insert>  
    </changeSet>
    
    <changeSet id="20120528_EMAIL" author="davidjones">
        <createTable tableName="EMAIL">
            <column name="id" type="BIGINT" >
                <constraints primaryKey="true" nullable="false" />
            </column>
            <column name="created" type="TIMESTAMP"><constraints nullable="false"/></column>
            <column name="updated" type="TIMESTAMP"></column>
            <column name="version" type="BIGINT"></column>
            <column name="sender" type="VARCHAR(256)"><constraints unique="false" nullable="false" /></column>
        </createTable>
        <addAutoIncrement tableName="EMAIL" columnName="id" columnDataType="bigint" />

    </changeSet>
</databaseChangeLog>
